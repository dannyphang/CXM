<div class="page-container lg:tw-m-[15px]" *ngIf="propertiesList">
  <p-tabView
    class="contact-company-tab-view"
    (onChange)="tabViewOnChange($event)"
    (onClose)="showCloseConfirmDialog($event)"
    [activeIndex]="returnActiveIndexPanel()"
    [controlClose]="true"
    *ngIf="panelList.length > 0"
  >
    <p-tabPanel
      *ngFor="let panel of panelList"
      [closable]="panel.closable && panelList.length > 1"
      [selected]="panel.panelUid === activeTabPanel"
      [disabled]="getIsPanelLoading()"
    >
      <ng-template pTemplate="header" class="tab-view-header">
        <div class="tw-flex tw-gap-[var(--content-gap)]">
          <div *ngIf="!panel.edit">{{ panel.headerLabel }}</div>
          <div *ngIf="panel.edit">
            <app-base-input
              [fieldControl]="returnTabLabelFormControl(panel)"
              (focusout)="updateUserPanelSetting(panel)"
            ></app-base-input>
          </div>

          <div class="tw-grid tw-items-center">
            <a (click)="editPanel(panel.panelUid); $event.stopPropagation()"
              ><span class="pi pi-pen-to-square"></span
            ></a>
          </div>
        </div>
      </ng-template>

      <ng-template pTemplate="content">
        <app-tab-panel-page
          [panel]="panel"
          [module]="module"
          [propertiesList]="propertiesList"
          [propertiesList2]="propertiesList2"
          [modulePropertyList]="modulePropertyList"
          (tabFilterEmit)="updateUserfilterSetting($event)"
          (tabColumnFilterEmit)="updateUserColumnSetting($event)"
          (tabFilterRemove)="updateUserFilterRemoveSetting($event)"
          [tableFilter]="returnTabPanelByTabUid(panel)"
          [tableColumnFilter]="returnColumnFilterByTabUid(panel)"
          (panelLoadingEmit)="updatePanelLoading($event)"
          *ngIf="propertiesList.length > 0"
        ></app-tab-panel-page>
      </ng-template>
    </p-tabPanel>

    <!-- add tab button -->
    <p-tabPanel>
      <ng-template pTemplate="header" class="tw-p-0">
        <app-base-button
          *ngIf="authService.returnPermissionObj('SETTING', 'update')"
          [iconName]="'pi pi-plus'"
          (click)="addTab(); $event.stopPropagation()"
          styleClass="tw-w-[52px] tw-h-[52px] "
          [isTextStyle]="true"
          [disabled]="panelList.length >= MAX_PANEL_LIST && getIsPanelLoading()"
          [label]="panelList.length + '/' + MAX_PANEL_LIST"
        >
        </app-base-button>
      </ng-template>
    </p-tabPanel>
  </p-tabView>
</div>

<p-dialog
  [(visible)]="closeDialogVisible"
  [header]="'INPUT.COMFIRMATION' | translate"
  [modal]="true"
  styleClass="tw-w-1/2"
>
  <ng-template pTemplate="content">
    <div>{{ "INPUT.CONFIRM_CLOSE" | translate }}</div>
  </ng-template>
  <ng-template pTemplate="footer">
    <div class="tw-flex tw-justify-between">
      <app-base-button
        [label]="'BUTTON.CANCEL'"
        (onClick)="closeDialogVisible = false"
        [severity]="'secondary'"
      ></app-base-button>
      <app-base-button
        [label]="'BUTTON.CONFIRM'"
        (onClick)="tabViewOnClose()"
      ></app-base-button>
    </div>
  </ng-template>
</p-dialog>
