<div class="tw-w-full">
  <p-tabView class="middle-profile-tabView tw-w-full">
    <p-tabPanel [header]="'ACTIVITY.ACTIVITIES' | translate">
      <div class="tw-flex tw-justify-between">
        <div class="tw-flex tw-items-center tw-gap-[var(--content-gap)]">
          <app-base-input
            [iconRightStyle]="searchIcon"
            [placeholder]="'INPUT.SEARCH_ACTIVITY_PLACEHOLDER' | translate"
            [autoFocus]="true"
            [fieldControl]="searchControl"
            class="tw-w-full"
          ></app-base-input>
          <i
            class="pi pi-info-circle"
            [pTooltip]="
              'ACTIVITY.SEARCH_TOOLTIP'
                | translate
                  : {
                      searchFields: searchFields.join(', ')
                    }
            "
            tooltipEvent="hover"
            tooltipPosition="top"
          ></i>
        </div>

        <!-- middle panel action button -->
        <div>
          <app-base-button
            [iconName]="'pi pi-ellipsis-v'"
            [isTextStyle]="true"
            [rounded]="true"
            (click)="profileActionMenu.toggle($event)"
          />
          <p-tieredMenu
            #profileActionMenu
            [model]="actionMenu"
            [popup]="true"
          />
        </div>
      </div>

      <p-tabView class="activity-tab">
        <!-- ALL Tab-->
        <p-tabPanel [header]="'ACTIVITY.ALL' | translate" [selected]="false">
          <!-- Pinned -->
          <div *ngIf="returnIsPinnedActivityList('ALL').length > 0">
            <div
              class="activity-label-div tw-flex tw-flex-wrap tw-items-center"
            >
              <i class="pi pi-star-fill"></i>
              <p class="pinned-label">{{ "ACTIVITY.PINNED" | translate }}</p>
            </div>
            <div
              *ngFor="let activity of returnIsPinnedActivityList('ALL')"
              class="tw-pb-[15px]"
            >
              <app-activity-block
                [activityModule]="returnModule(activity)"
                [activityControlList]="activityControlList"
                [activityModuleList]="activityModuleList"
                [activity]="activity"
                [moduleLable]="'ALL'"
                (activityReload)="activityListEmit.emit()"
                [contactProfile]="contactProfile"
                [companyProfile]="companyProfile"
              ></app-activity-block>
            </div>
          </div>

          <!-- UpComing -->
          <div *ngIf="returnUpComingActivityList('ALL').length > 0">
            <div
              class="activity-label-div tw-flex tw-flex-wrap tw-items-center"
            >
              <i class="pi pi-calendar"></i>
              <p class="upcoming-label">
                {{ "ACTIVITY.UPCOMING" | translate }}
              </p>
            </div>
            <div
              *ngFor="let activity of returnUpComingActivityList('ALL')"
              class="tw-pb-[15px]"
            >
              <app-activity-block
                [activityModule]="returnModule(activity)"
                [activityControlList]="activityControlList"
                [activityModuleList]="activityModuleList"
                [activity]="activity"
                [moduleLable]="'ALL'"
                (activityReload)="activityListEmit.emit()"
                [module]="module"
                [contactProfile]="contactProfile"
                [companyProfile]="companyProfile"
              ></app-activity-block>
            </div>
          </div>

          <!-- Past -->
          <div *ngIf="returnPastActivityList('ALL').length > 0">
            <div
              class="activity-label-div tw-flex tw-flex-wrap tw-items-center"
            >
              <i class="pi pi-calendar"></i>
              <p class="upcoming-label">
                {{ "ACTIVITY.PAST" | translate }}
              </p>
            </div>
            <div
              *ngFor="let activity of returnPastActivityList('ALL')"
              class="tw-pb-[15px]"
            >
              <app-activity-block
                [activityModule]="returnModule(activity)"
                [activityControlList]="activityControlList"
                [activityModuleList]="activityModuleList"
                [activity]="activity"
                [moduleLable]="'ALL'"
                (activityReload)="activityListEmit.emit()"
                [module]="module"
                [contactProfile]="contactProfile"
                [companyProfile]="companyProfile"
              ></app-activity-block>
            </div>
          </div>
        </p-tabPanel>

        <!-- Other Tab -->
        <p-tabPanel
          *ngFor="let activityTab of activityModuleList"
          [header]="'ACTIVITY.MODULE.' + activityTab.moduleCode | translate"
          onclick=""
        >
          <div class="">
            <div
              class="tw-flex tw-justify-end tw-mb-[var(--content-gap)] tw-gap-[var(--content-gap)]"
            >
              <app-base-button
                *ngIf="isIncludedActivity(activityTab, 'LOG')"
                [outlined]="true"
                [label]="returnLogActivityLable(activityTab)"
                class=""
                (onClick)="activityButtonOnClick(activityTab)"
              ></app-base-button>

              <app-base-button
                *ngIf="isIncludedActivity(activityTab, 'CREATE')"
                [label]="returnCreateActivityLable(activityTab)"
                (onClick)="activityCreateButtonOnClick(activityTab)"
              ></app-base-button>
            </div>

            <!-- Pinned -->
            <div
              *ngIf="
                returnIsPinnedActivityList(activityTab.moduleCode).length > 0
              "
            >
              <div
                class="activity-label-div tw-flex tw-flex-wrap tw-items-center"
              >
                <i class="pi pi-star-fill"></i>
                <p class="pinned-label">{{ "ACTIVITY.PINNED" | translate }}</p>
              </div>

              <div
                *ngFor="
                  let activity of returnIsPinnedActivityList(
                    activityTab.moduleCode
                  )
                "
                class="tw-pb-[15px]"
              >
                <app-activity-block
                  [subActivityModule]="returnSubModuleList(activityTab)"
                  [activityModule]="activityTab"
                  [activityControlList]="getActivityControlList(activityTab)"
                  [activityModuleList]="activityModuleList"
                  [activity]="activity"
                  (activityReload)="activityListEmit.emit()"
                  [module]="module"
                  [contactProfile]="contactProfile"
                  [companyProfile]="companyProfile"
                ></app-activity-block>
              </div>
            </div>

            <!-- UpComing -->
            <div
              *ngIf="
                returnUpComingActivityList(activityTab.moduleCode).length > 0
              "
            >
              <div
                class="activity-label-div tw-flex tw-flex-wrap tw-items-center"
              >
                <i class="pi pi-calendar"></i>
                <p class="upcoming-label">
                  {{ "ACTIVITY.UPCOMING" | translate }}
                </p>
              </div>
              <div
                *ngFor="
                  let activity of returnUpComingActivityList(
                    activityTab.moduleCode
                  )
                "
                class="tw-pb-[15px]"
              >
                <app-activity-block
                  [subActivityModule]="returnSubModuleList(activityTab)"
                  [activityModule]="activityTab"
                  [activityControlList]="getActivityControlList(activityTab)"
                  [activityModuleList]="activityModuleList"
                  [activity]="activity"
                  (activityReload)="activityListEmit.emit()"
                  [module]="module"
                  [contactProfile]="contactProfile"
                  [companyProfile]="companyProfile"
                ></app-activity-block>
              </div>
            </div>

            <!-- Past -->
            <div
              *ngIf="returnPastActivityList(activityTab.moduleCode).length > 0"
            >
              <div
                class="activity-label-div tw-flex tw-flex-wrap tw-items-center"
              >
                <i class="pi pi-calendar"></i>
                <p class="upcoming-label">
                  {{ "ACTIVITY.PAST" | translate }}
                </p>
              </div>
              <div
                *ngFor="
                  let activity of returnPastActivityList(activityTab.moduleCode)
                "
                class="tw-pb-[15px]"
              >
                <app-activity-block
                  [subActivityModule]="returnSubModuleList(activityTab)"
                  [activityModule]="activityTab"
                  [activityControlList]="activityControlList"
                  [activityModuleList]="activityModuleList"
                  [activity]="activity"
                  [moduleLable]="'ALL'"
                  (activityReload)="activityListEmit.emit()"
                  [module]="module"
                  [contactProfile]="contactProfile"
                  [companyProfile]="companyProfile"
                ></app-activity-block>
              </div>
            </div>
          </div>
        </p-tabPanel>
      </p-tabView>
    </p-tabPanel>
    <!-- <p-tabPanel header="Properties"> </p-tabPanel> -->
  </p-tabView>
</div>

<app-activity-dialog
  [module]="module"
  [activityModule]="dialogActivityTab"
  [visible]="isOpenDialog"
  [contactProfile]="contactProfile"
  [companyProfile]="companyProfile"
  [activityControlListInput]="getActivityControlList(dialogActivityTab)"
  [activityModuleList]="activityModuleList"
  [header]="returnLogActivityLable(dialogActivityTab)"
  (close)="activityDialogCloseEmit()"
></app-activity-dialog>

<app-activity-create-dialog
  [module]="module"
  [activityModule]="dialogActivityTab"
  [visible]="isOpenCreateDialog"
  [contactProfile]="contactProfile"
  [companyProfile]="companyProfile"
  (close)="activityCreateDialogCloseEmit()"
></app-activity-create-dialog>
