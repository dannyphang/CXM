<!-- <app-toast></app-toast> -->

<!-- update profile form dialog -->
<p-dialog
  [(visible)]="showFormUpdateSidebar"
  [position]="'bottom'"
  styleClass="tw-w-full tw-m-[var(--content-gap)]"
>
  <ng-template pTemplate="headless">
    <div
      *ngIf="propUpdateList"
      class="tw-flex tw-flex-wrap tw-items-center tw-m-[15px]"
    >
      <div class="tw-flex tw-gap-[var(--content-gap)]">
        <app-base-button
          [label]="'BUTTON.SAVE'"
          styleClass=""
          class="tw-w-full"
          (onClick)="saveButton(module, contactProfile, companyProfile)"
        ></app-base-button>
        <app-base-button
          [label]="'BUTTON.CANCEL'"
          class=""
          [severity]="'secondary'"
          (onClick)="cancelButton()"
        ></app-base-button>
      </div>

      <app-base-label
        [label]="
          'You\'ve changed ' +
          propUpdateList.length +
          (propUpdateList.length === 1 ? ' property' : ' properties') +
          '.'
        "
        class="tw-ml-[15px]"
      ></app-base-label>
    </div>
  </ng-template>
</p-dialog>

<!-- Edit profile picture dialog -->
<p-dialog
  [(visible)]="isShowAvatarEditDialog"
  styleClass="tw-w-[50%] tw-m-[var(--content-gap)]"
  [modal]="true"
  [header]="'PROFILE.AVATAR_EDIT' | translate"
  (onHide)="onCloseProfileDialog()"
  [closeOnEscape]="false"
>
  <div class="tw-grid">
    <img
      [src]="profileImg"
      class="tw-w-full tw-aspect-square tw-border tw-border-solid tw-border-[var(--primary-color)] tw-object-cover tw-mb-[var(--content-gap)]"
    />
    <div class="tw-flex tw-justify-between">
      <app-base-button
        [iconName]="'pi pi-plus'"
        [rounded]="true"
        (onClick)="imageUploader.click()"
        class=""
        [pTooltip]="'BUTTON.ATTACH_FILE' | translate"
        *ngIf="checkPermission('update', module, permission)"
      ></app-base-button>

      <app-chip
        *ngIf="profilePhotoFile"
        [label]="profilePhotoFile.name"
        [removable]="false"
        class="tw-grid tw-items-center"
      ></app-chip>

      <app-base-button
        [label]="'BUTTON.UPLOAD' | translate"
        (onClick)="imageFileUploadBtn()"
        *ngIf="checkPermission('update', module, permission)"
      ></app-base-button>
    </div>
  </div>
</p-dialog>

<input
  type="file"
  id="file-input"
  #imageUploader
  hidden
  (change)="imageFileUpload($event)"
  accept="image/*"
/>

<div class="">
  <div class="tw-bg-[var(--primary-color-text)]">
    <!-- avatar, username -->
    <div
      class="left-top-area tw-p-[var(--content-gap)] tw-border tw-border-[var(--primary-color)] tw-border-solid"
    >
      <!-- avatar -->
      <div
        class="avatar-div"
        (mouseenter)="
          checkPermission('update', module, permission)
            ? (isAvatarEdit = true)
            : (isAvatarEdit = false)
        "
        (mouseleave)="isAvatarEdit = false"
      >
        <app-base-button
          [iconName]="'pi pi-file-edit'"
          [buttonStyleClass]="'tw-w-[80px] tw-h-[80px] avatar-edit'"
          [rounded]="true"
          *ngIf="isAvatarEdit && checkPermission('update', module, permission)"
          [isTextStyle]="true"
          (onClick)="editPic()"
          [pTooltip]="'PROFILE.AVATAR_EDIT' | translate"
        ></app-base-button>
        <p-avatar
          *ngIf="
            !contactProfile?.contactProfilePhotoUrl &&
            !companyProfile?.companyProfilePhotoUrl
          "
          [icon]="'pi pi-user'"
          styleClass="tw-w-[80px] tw-h-[80px]"
          [ngClass]="isAvatarEdit ? 'tw-opacity-[0.5]' : 'tw-opacity-[1]'"
          shape="circle"
          data-blobity-magnetic="true"
        />
        <p-avatar
          *ngIf="
            contactProfile?.contactProfilePhotoUrl ||
            companyProfile?.companyProfilePhotoUrl
          "
          [image]="
            module === 'CONT'
              ? contactProfile?.contactProfilePhotoUrl
              : companyProfile?.companyProfilePhotoUrl
          "
          styleClass="tw-w-[80px] tw-h-[80px]"
          [ngClass]="isAvatarEdit ? 'tw-opacity-[0.5]' : 'tw-opacity-[1]'"
          shape="circle"
          data-blobity-magnetic="true"
        />
      </div>

      <!-- middle -->
      <div class="info-div tw-overflow-hidden tw-content-evenly tw-grid">
        <!-- username -->
        <app-base-label
          [label]="
            module === 'CONT'
              ? contactProfile?.contactFirstName
                ? contactProfile?.contactFirstName +
                  ' ' +
                  contactProfile?.contactLastName
                : ''
              : companyProfile?.companyName
              ? companyProfile?.companyName
              : ''
          "
          [labelStyle]="'text-hidden-dots profile-name-label'"
        ></app-base-label>

        <!-- email -->
        <div class="email-div tw-grid">
          <a
            class="email-text text-hidden-dots tw-content-center tw-cursor-pointer"
            (click)="
              copyEmailToClipboard(
                module === 'CONT'
                  ? contactProfile?.contactEmail
                  : companyProfile?.companyEmail
              )
            "
            [pTooltip]="'MESSAGE.COPY_EMAIL' | translate"
          >
            {{
              module === "CONT"
                ? contactProfile?.contactEmail
                : companyProfile?.companyEmail
            }}
          </a>
        </div>
      </div>

      <!-- more button -->
      <div class="action-div tw-flex tw-justify-end">
        <app-base-button
          [iconName]="'pi pi-ellipsis-v'"
          [isTextStyle]="true"
          [rounded]="true"
          (click)="profileActionMenu.toggle($event)"
          class="tw-h-fit"
        />
        <p-tieredMenu #profileActionMenu [model]="actionMenu" [popup]="true" />
      </div>
    </div>

    <!-- action buttons -->
    <!-- <div class="action-btn-div">
      <app-base-button
        *ngIf="checkPermission('create', module, permission)"
        [iconName]="'pi pi-file-edit'"
        [rounded]="true"
        [isTextStyle]="true"
        [outlined]="true"
        [buttonClass]="
          'tw-bg-[var(--primary-color-text)] left-panel-action-button'
        "
        pTooltip="Create a note"
      />
      <app-base-button
        *ngIf="checkPermission('create', module, permission)"
        [iconName]="'pi pi-envelope'"
        [rounded]="true"
        [isTextStyle]="true"
        [outlined]="true"
        [buttonClass]="
          'tw-bg-[var(--primary-color-text)] left-panel-action-button'
        "
        pTooltip="Create an email"
      />
      <app-base-button
        *ngIf="checkPermission('create', module, permission)"
        [iconName]="'pi pi-phone'"
        [rounded]="true"
        [isTextStyle]="true"
        [outlined]="true"
        [buttonClass]="
          'tw-bg-[var(--primary-color-text)] left-panel-action-button'
        "
        pTooltip="Make a phone call"
      />
      <app-base-button
        *ngIf="checkPermission('create', module, permission)"
        [iconName]="'pi pi-list-check'"
        [rounded]="true"
        [isTextStyle]="true"
        [outlined]="true"
        [buttonClass]="
          'tw-bg-[var(--primary-color-text)] left-panel-action-button'
        "
        pTooltip="Create a task"
      />
      <app-base-button
        *ngIf="checkPermission('create', module, permission)"
        [iconName]="'pi pi-calendar-plus'"
        [rounded]="true"
        [isTextStyle]="true"
        [outlined]="true"
        [buttonClass]="
          'tw-bg-[var(--primary-color-text)] left-panel-action-button'
        "
        pTooltip="Schedule a meeting"
      />
      <app-base-button
        [iconName]="'pi pi-ellipsis-h'"
        [rounded]="true"
        [isTextStyle]="true"
        [outlined]="true"
        [buttonClass]="
          'tw-bg-[var(--primary-color-text)] left-panel-action-button'
        "
        pTooltip="More"
      />
    </div> -->
  </div>

  <!-- property form -->
  <div class="tw-border" *ngFor="let propertyGroup of propertiesList">
    <div
      *ngIf="
        propertyGroup.moduleCode == 'CONT_INFO' ||
        propertyGroup.moduleCode == 'COMP_INFO'
      "
      class="panel-div"
    >
      <app-accordion-panel
        class="profile-panel-div"
        [iconPos]="'start'"
        [isExpand]="true"
      >
        <div acc-panel-header class="text-hidden-dots">
          {{ propertyGroup.moduleName }}
        </div>
        <div acc-panel-body class="panel-content-div">
          <app-base-form
            [formConfig]="returnProfileFormConfig(propertyGroup.moduleCode)"
            class="left-profile-form"
          ></app-base-form>
        </div>
      </app-accordion-panel>
    </div>
  </div>
</div>
