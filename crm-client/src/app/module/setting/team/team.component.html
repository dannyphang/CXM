<div class="tw-p-[var(--content-gap)] tw-pt-0 tw-w-full">
  <h2 class="tw-text-[var(--text-color)]">
    {{ "SETTING.TEAM_MANAGEMENT" | translate }}
  </h2>

  <div class="permission-table">
    <p-table
      #dt
      [columns]="tableConfig"
      [value]="selectedUserFormGroup.controls['permission'].value"
      [resizableColumns]="true"
      [reorderableColumns]="true"
      [rowHover]="true"
      styleClass="p-datatable-gridlines p-datatable-striped"
      [rows]="ROW_PER_PAGE_DEFAULT"
      [rowsPerPageOptions]="ROW_PER_PAGE_DEFAULT_LIST"
    >
      <ng-template pTemplate="caption">
        <app-base-dropdown
          [options]="userListOptions"
          [fieldControl]="returnSelectUserFormControl()"
        ></app-base-dropdown>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th *ngFor="let col of columns">
            {{ col.header }}
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr>
          <td *ngFor="let col of columns">
            <div *ngIf="col.field === 'module'">
              {{ rowData[col.field] }}
            </div>
            <div *ngIf="col.field !== 'module'">
              <p-inputSwitch
                [ngModel]="rowData.permission[col.field].value"
                (onChange)="
                  permissionSwitchOnChange(rowData, col.field, $event)
                "
              />
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="footer">
        <p-button
          [label]="'BUTTON.SAVE' | translate"
          (onClick)="submitPermission()"
        ></p-button>
      </ng-template>
    </p-table>
  </div>

  <div
    class="tw-pb-[var(--content-gap)]"
    *ngFor="let team of teamFormArr.controls; let i = index"
  >
    <p-divider *ngIf="teamFormArr.controls.length > 1 && i !== 0"></p-divider>
    <div class="tw-flex tw-w-full">
      <app-base-input
        [label]="'SETTING.USER_EMAIL' | translate"
        [fieldControl]="returnTeamFormControl('email', team)"
        [mode]="'email'"
        class="tw-w-full"
      ></app-base-input>
      <app-base-dropdown
        [label]="'SETTING.ROLE' | translate"
        [fieldControl]="returnTeamFormControl('role', team)"
        [options]="roleOptions"
        class="tw-w-[30%] tw-ml-[var(--content-gap)]"
      ></app-base-dropdown>
      <p-button
        [icon]="returnCheckIcon(team)"
        [rounded]="true"
        (onClick)="checkUserEmail(team)"
        [pTooltip]="'BUTTON.CHECK_USER_EMAIL' | translate"
        class="tw-flex tw-items-end tw-ml-[var(--content-gap)]"
      ></p-button>
      <p-button
        [icon]="'pi pi-minus'"
        [rounded]="true"
        [outlined]="true"
        (onClick)="removeTeam(i)"
        class="tw-flex tw-items-end tw-ml-[var(--content-gap)]"
        *ngIf="teamFormArr.controls.length !== 1"
      ></p-button>
    </div>
  </div>
  <div class="tw-flex tw-justify-center">
    <p-button
      [icon]="'pi pi-plus'"
      [rounded]="true"
      (onClick)="addTeamFormArr()"
    ></p-button>
  </div>

  <p-button
    [label]="'BUTTON.SUBMIT' | translate"
    (onClick)="submitTeam()"
  ></p-button>
</div>
